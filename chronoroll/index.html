<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chrono Roll</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="stile.css">
    <script src="https://unpkg.com/dsteem@^0.8.0/dist/dsteem.js"></script>

    <style>
    .body{
        background: rgb(42, 42, 44);
    }
    .container-ttc{
        background: #4C4953;
        color: rgb(181, 179, 185);
        border-color: #6F1DAF ;
    }
    .perfilpr{
        color: #000000
    }
    .relog{
        line-height: 200px; 
        width: 200px; 
        height: 200px;
        background-color:#6F1DAF;
    }
    .bg-ttc{
        background-color: #6F1DAF!important;
    }
    .btn-ttc{
        color: rgb(255, 255, 255);
        background-color: #6F1DAF;
    }
    .btn-ttc:hover{
        color: rgb(255, 255, 255);
        background-color: #3E0A66;
    }
    .btn-ttc:active {
        color: rgb(255, 255, 255);
    }
    #navbarText{
        color: rgb(255, 255, 255);
    }
    .btn-ttc:disabled{
        background-color: #D49CFE;
    }
    .alert-ttc {
        color: #280C3D;
        background-color: #D49CFE;
        border-color: #D49CFE;
    }
    .custom-toggler.navbar-toggler {
    border-color: rgb(0, 0, 0);
    }
    .custom-toggler .navbar-toggler-icon {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgb(0, 0, 0)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 8h24M4 16h24M4 24h24'/%3E%3C/svg%3E");
    }
    </style>
</head>
<body class="container">
    <div id="container-ttc" class="card">
        <h5 class="card-header bg-ttc text-white">
            <center>ChronoRoll</center>
        </h5>

        <nav class="navbar navbar-expand-lg bg-ttc">
            <button id="cl-colapce" class="navbar-toggler custom-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link">HOME</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link">FAQ</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link">BLOG</a>
                    </li>
                </ul>
                <span class="navbar-text">
                    noche
                </span>
            </div>
        </nav>


        <div class="card-body">
            <div>
                <div class="row">
                    <div class="col-lg-4 col-sm-12">
                        <div id="busqueuser" class="d-none card text-center" >
                            <input type="text" class="form-control" id="buqueuser" placeholder="Username">
                            </br>
                            <center>
                                <button type="button" class="btn btn-ttc" onclick="infouser();">Submit</button>
                            </center>
                        </div>
                        <div id="perfilpr" class="d-none card text-center">
                            <div class="card-body">
                                <h5 class="card-title" id="perfil">username</h5>
                                <img id="imgperfil" src="https://steemitimages.com/512x512/https://steemitimages.com/DQmb2HNSGKN3pakguJ4ChCRjgkVuDN9WniFRPmrxoJ4sjR4" style="width: 75px; height: 75px; padding: 5px;" class="rounded-circle">
                                <br />
                                <a href="https://chronocrypto.github.io/chronoroll/" class="btn btn-ttc">logout</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-12">
                        <center>
                            <div class="rounded-circle text-white" id="ant" style="line-height: 200px;width: 200px;height: 200px;background-color:#6F1DAF;">
                                <p id="odometer">click roll</p>
                            </div>
                        </center>
                    </div>
                    <div class="col-lg-4 col-sm-12">
                        <div id="saldos" class="d-none card p-4 text-primary" >
                            <div class="card-body">
                                <h3><span class="text-dark" id="steemcan">0.000 STEEM</span></h3>
                                <br />
                                <h3><span class="text-dark" id="sbdcan">0.000 SBD</span></h3>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="input-group col-lg-5 col-sm-12">
                        <input type="number" id="amountsteem" class="form-control" max="5" min="0.1" onchange="porcent();cammbion()" value="0.1">
                        <div class="input-group-append">
                            <button class="input-group-addon btn btn-ttc" onclick="x2();cammbion()">x2</button>
                        </div>
                    </div>
                    <div class="input-group col-lg-5 col-sm-12">
                        <input class="form-control" id="porcenta" type="number" max="99" min="1" value="50" onchange="porcent();" />
                        <div class="input-group-append">
                                <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-sm-12">
                        <select id="typ" class="col form-control">
                            <option selected>LOW</option>
                            <option>HIGH</option>
                        </select>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="col-lg-10 col-sm-12">
                        <div id="ms" class="alert alert-ttc ">
                            If you have the winning number, you will receive 0.196 STEEM
                        </div>
                        
                    </div>
                    <div class="col-lg-2 col-sm-12">
                        <button type="button" id="coinmoney" onclick="cambiomoneda()" class="btn btn-ttc btn-lg btn-block">STEEM</button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-10 col-sm-12">
                            <input class="btn btn-ttc col-12" id="rolval" type="submit" onclick="numero()" value="Roll">
                    </div>
                        
                    <div class="col-lg-2 col-sm-12">
                            <input class="btn btn-ttc col-12" id="steemconnectV" type="submit" onclick="steemconnect()" value="steemconnect">
                    </div>
                        
                </div>
            </div>
        </div>
        <div class="card-body">
            <table class="table">
            <thead>
                <tr>
                    <th scope="col">Block</th>
                    <th scope="col">Type</th>
                    <th scope="col">Percentage</th>
                    <th scope="col">Result</th>
                </tr>
            </thead>
            <tbody id="props">
                
            </tbody>
            </table>
        </div>
    </div>



    <script type="text/javascript">
        var rpcnodes=[
            "https://api.steemit.com",
            "https://rpc.buildteam.io",
        ]
        var noderpc= rpcnodes ? rpcnodes[0] : (rpcnodes ? rpcnodes[1] : 'https://api.steemit.com')
        var client = new dsteem.Client(noderpc)
        sesion()
        var coin='STEEM'
        var to="chronoroll"
        var type="day"
        var steemc=false
        var hg=false
        function invesdata(){
            hg=true
            if(hg==true){
                document.getElementById("steemconnectV").disabled=true
            }
            client.database.getAccounts([user]).then(function (result) {
                var json=JSON.parse(result[0].json_metadata)
                if(json.profile.profile_image===undefined){
                    document.getElementById("imgperfil").src="https://steemitimages.com/512x512/https://steemitimages.com/DQmb2HNSGKN3pakguJ4ChCRjgkVuDN9WniFRPmrxoJ4sjR4"
                }
                else{
                    document.getElementById("imgperfil").src=json.profile.profile_image;
                }
                document.getElementById("perfil").innerHTML=result[0].name
                document.getElementById("steemcan").innerHTML=result[0].balance;
                document.getElementById("sbdcan").innerHTML=result[0].sbd_balance
                                
                setInterval(function(){
                    client.database.getAccounts([user]).then(function (resty) {
                        var sasteem=parseFloat(document.getElementById("steemcan").value)
                        var sasbd=parseFloat(document.getElementById("sbdcan").value)
                        if(parseFloat(resty[0].balance)!=sasteem || parseFloat(resty[0].sbd_balance)!=sasbd){
                            document.getElementById("steemcan").innerHTML=resty[0].balance
                            document.getElementById("sbdcan").innerHTML=resty[0].sbd_balance
                        }
                    })
                }, 1000);
            })
            var ty=document.getElementById("perfilpr")
            var sal=document.getElementById("saldos")
            sal.className ="card text-center"
            ty.className ="card text-center"
    
            tabladato()
    
        }
        function infouser(){
            var userstencot=document.getElementById("buqueuser").value
            if(userstencot){
                    user=userstencot
                    var du=document.getElementById("busqueuser")
                    du.className="d-none"
                    invesdata()
            }
        }
        function sesion(){
                document.getElementById("rolval").disabled=true;
                if(steemc==true){
                    var ct=document.getElementById("busqueuser")
                    ct.className=""
                    document.getElementById("rolval").disabled=false;
                    document.getElementById("ant").innerHTML="<p id='odometer'>click roll</p>"
                }
            
        }
        function numero(){
            var idoto=document.getElementById("typ").value
            odometer.innerHTML=idoto
            idoto=idoto.toLowerCase()
            var amountsend=document.getElementById("amountsteem").value
            amountsend=Math.floor(amountsend * 1000) / 1000;
            var cani=amountsend.toFixed(3)+" "+coin
            var canis=amountsend.toFixed(3)
            var porcen=parseFloat(document.getElementById("porcenta").value)
            var data1='{'+'"type":'+'"'+idoto+'"'+','+'"possibility"'+':'+porcen+'}'
            var memo=data1.toString()
            if(steemc==true){
                var altura=500;
                var anchura=560;
                var y=parseInt((window.screen.height/3)-(altura/3));
                var x=parseInt((window.screen.width/2)-(anchura/2));
                var dato="https://v2.steemconnect.com/sign/transfer?from=&to="+to+"&amount="+canis+"%20"+coin+"&memo="+data1
                window.open(dato, "steemconnect","width="+altura+",height="+anchura+",top="+y+",left="+x)
            }
            
        }
        function cambiomoneda(){
            if(coin=="STEEM"){
                coin="SBD"
                document.getElementById("coinmoney").innerHTML="SBD"
                cammbion()
            }else{
                coin="STEEM"
                document.getElementById("coinmoney").innerHTML="STEEM"
                cammbion()
            }
        }
        function cammbion(){
            var cantidad=document.getElementById("amountsteem").value
            var porcentactuldinput=(document.getElementById("porcenta").value)/100
            if(cantidad<0.1){
                document.getElementById("amountsteem").value=0.1
                var amount=(0.098*1*cantidad)/(0.1*porcentactuldinput)
                var al=amount.indexOf(".")
                var menssage="If you have the winning number, you will receive "+amount.toFixed(3)+" "+coin
                document.getElementById("ms").innerHTML=menssage
            }
            else if(cantidad>5){
                document.getElementById("amountsteem").value=5
                var amount=(0.098*1*cantidad)/(0.1*porcentactuldinput)
                var menssage="If you have the winning number, you will receive "+amount.toFixed(3)+" "+coin
                document.getElementById("ms").innerHTML=menssage
            }
            else {
                var amount=(0.098*1*cantidad)/(0.1*porcentactuldinput)
                var menssage="If you have the winning number, you will receive "+amount.toFixed(3)+" "+coin
                document.getElementById("ms").innerHTML=menssage
            }
        }
        function x2(){
            var dato=document.getElementById("amountsteem").value
            var multiple=parseFloat(dato)*2
            document.getElementById("amountsteem").value=multiple
            porcent()
        }
        function porcent(){
            var por=document.getElementById("porcenta").value
            var saldop=document.getElementById("amountsteem").value
            var tyd=(saldop*0.98*0.1)/0.025
            if(por<tyd){
                document.getElementById("porcenta").value=tyd
                cammbion()
            }
            if(por>99.99){
                document.getElementById("porcenta").value=99.99
                cammbion()
            }
            else {
                cammbion()
            }
        }
        function sortJSON(data, key, orden) {
        return data.sort(function (a, b) {
            var x = a[key],
            y = b[key];
            if (orden === 'asc') {
                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
            }
            if (orden === 'desc') {
                return ((x > y) ? -1 : ((x < y) ? 1 : 0));
            }
        });
    }
        function IsJsonString(str) { 
            try { JSON.parse(str); }
            catch (e) { return false; } 
            return true; 
        } 
        function tabladato(){
            var blocktest=[]
            setInterval(function testtabla(){
                client.database.call('get_account_history', [user, -1, 1000]).then(function (result) {
                var transfers = result.filter( tx => tx[1].op[0] =='transfer' && tx[1].op[1].to==to ||  tx[1].op[1].from==to)
                var asc=sortJSON(transfers,"[1].block","asc")
                asc.map(function(ele){
                    
                    if(ele[1].op[1].from==to){
                        var memofrom=ele[1].op[1].memo
                        var positionm=memofrom.indexOf(";")
                        var men=memofrom.substring(0,positionm)
                        //{}
                        if(blocktest.includes(ele[1].block)==false){
                            if(IsJsonString(men)==true){
                                blocktest.push((ele[1].block))
                                var json2=JSON.parse(men)
                                var datot=document.getElementById(json2.block).innerHTML
                                document.getElementById(json2.block).innerHTML=datot+"<td>"+json2.result+"</td>"
                            }
                        }
                    }
                    else if(ele[1].op[1].to==to){
                        ele[1].op[1].amount//cantidad enviada
                        var dating=ele[1].op[1].memo
                        if(blocktest.includes(ele[1].block)==false){
                            if(IsJsonString(dating)==true){
                                blocktest.push((ele[1].block))
                                var json1=JSON.parse(dating)
                                var resuldatotopush="<tr id="+ele[1].block+">"+"<td>"+ele[1].block+"</td>"+"<td>"+json1.type+"</td>"+"<td>"+json1.possibility+"</td>"+"</tr>"
                                var daytabla=document.getElementById("props").innerHTML
                                document.getElementById("props").innerHTML=daytabla+resuldatotopush
                            }
                        }
                    }
                    
                })
            });
    
            }, 1000);
        }
        function steemconnect(){
            ses=true
            steemc=true
            sesion();
        }
    </script>

</body>

</html>
